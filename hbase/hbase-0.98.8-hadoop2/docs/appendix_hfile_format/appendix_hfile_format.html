<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Appendix&nbsp;A.&nbsp;HFile format</title><link rel="stylesheet" type="text/css" href="../css/freebsd_docbook.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><link rel="home" href="appendix_hfile_format.html" title="Appendix&nbsp;A.&nbsp;HFile format"><link rel="next" href="hfilev2.html" title="A.2.&nbsp; HBase file format with inline blocks (version 2)"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Appendix&nbsp;A.&nbsp;HFile format</th></tr><tr><td width="20%" align="left">&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="hfilev2.html">Next</a></td></tr></table><hr></div><script type="text/javascript">
    var disqus_shortname = 'hbase'; // required: replace example with your forum shortname
    var disqus_url = 'http://hbase.apache.org/book/hfile_format.html';
    </script><div class="appendix" title="Appendix&nbsp;A.&nbsp;HFile format"><div class="titlepage"><div><div><h2 class="title"><a name="hfile_format"></a>Appendix&nbsp;A.&nbsp;HFile format</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="appendix_hfile_format.html#hfilev1">A.1. HBase File Format (version 1)</a></span></dt><dd><dl><dt><span class="section"><a href="appendix_hfile_format.html#hfilev1.overview">A.1.1. Overview of Version 1</a></span></dt><dt><span class="section"><a href="appendix_hfile_format.html#d644e32">A.1.2.  Block index format in version 1 </a></span></dt></dl></dd><dt><span class="section"><a href="hfilev2.html">A.2. 
      HBase file format with inline blocks (version 2)
      </a></span></dt><dd><dl><dt><span class="section"><a href="hfilev2.html#d644e61">A.2.1. Motivation </a></span></dt><dt><span class="section"><a href="hfilev2.html#hfilev2.overview">A.2.2. Overview of Version 2</a></span></dt><dt><span class="section"><a href="hfilev2.html#d644e84">A.2.3. Unified version 2 block format</a></span></dt><dt><span class="section"><a href="hfilev2.html#d644e153">A.2.4.  Block index in version 2</a></span></dt><dt><span class="section"><a href="hfilev2.html#d644e178">A.2.5. 
      Root block index format in version 2</a></span></dt><dt><span class="section"><a href="hfilev2.html#d644e231">A.2.6. 
      Non-root block index format in version 2</a></span></dt><dt><span class="section"><a href="hfilev2.html#d644e256">A.2.7. 
      Bloom filters in version 2</a></span></dt><dt><span class="section"><a href="hfilev2.html#d644e293">A.2.8. File Info format in versions 1 and 2</a></span></dt><dt><span class="section"><a href="hfilev2.html#d644e339">A.2.9. 
      Fixed file trailer format differences between versions 1 and 2</a></span></dt><dt><span class="section"><a href="hfilev2.html#d644e482">A.2.10. getShortMidpointKey(an optimization for data index block)</a></span></dt></dl></dd><dt><span class="section"><a href="hfilev3.html">A.3. HBase File Format with Security Enhancements (version 3)</a></span></dt><dd><dl><dt><span class="section"><a href="hfilev3.html#hfilev3.motivation">A.3.1. Motivation </a></span></dt><dt><span class="section"><a href="hfilev3.html#hfilev3.overview">A.3.2. Overview</a></span></dt><dt><span class="section"><a href="hfilev3.html#hvilev3.infoblock">A.3.3. File Info Block in Version 3</a></span></dt><dt><span class="section"><a href="hfilev3.html#hfilev3.datablock">A.3.4. Data Blocks in Version 3</a></span></dt><dt><span class="section"><a href="hfilev3.html#hfilev3.fixedtrailer">A.3.5. Fixed File Trailer in Version 3</a></span></dt></dl></dd></dl></div><p>This appendix describes the evolution of the HFile format.</p><div class="section" title="A.1.&nbsp;HBase File Format (version 1)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="hfilev1"></a>A.1.&nbsp;HBase File Format (version 1)</h2></div></div></div><p>As we will be discussing changes to the HFile format, it is useful to give a short overview of the original (HFile version 1) format.</p><div class="section" title="A.1.1.&nbsp;Overview of Version 1"><div class="titlepage"><div><div><h3 class="title"><a name="hfilev1.overview"></a>A.1.1.&nbsp;Overview of Version 1</h3></div></div></div><p>An HFile in version 1 format is structured as follows:</p><div class="figure"><a name="d644e17"></a><p class="title"><b>Figure&nbsp;A.1.&nbsp;HFile V1 Format</b></p><div class="figure-contents"><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0"><tr><td align="center" valign="middle"><img src="../images/hfile.png" align="middle" alt="HFile Version 1"></td></tr></table><div class="caption"><p>Image courtesy of Lars George, <a class="link" href="http://www.larsgeorge.com/2009/10/hbase-architecture-101-storage.html" target="_top">hbase-architecture-101-storage.html</a>.</p></div></div></div></div><br class="figure-break"></div><div class="section" title="A.1.2.&nbsp; Block index format in version 1"><div class="titlepage"><div><div><h3 class="title"><a name="d644e32"></a>A.1.2.&nbsp; Block index format in version 1 </h3></div></div></div><p>The block index in version 1 is very straightforward. For each entry, it contains: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Offset (long)</p></li><li class="listitem"><p>Uncompressed size (int)</p></li><li class="listitem"><p>Key (a serialized byte array written using Bytes.writeByteArray) </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Key length as a variable-length integer (VInt)
                  </p></li><li class="listitem"><p>
                     Key bytes
                 </p></li></ol></div></li></ol></div><p>The number of entries in the block index is stored in the fixed file trailer, and has to be passed in to the method that reads the block index. One of the limitations of the block index in version 1 is that it does not provide the compressed size of a block, which turns out to be necessary for decompression. Therefore, the HFile reader has to infer this compressed size from the offset difference between blocks. We fix this limitation in version 2, where we store on-disk block size instead of uncompressed size, and get uncompressed size from the block header.</p></div></div></div><div id="disqus_thread"></div><script type="text/javascript">
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left">&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="hfilev2.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right" valign="top">&nbsp;A.2.&nbsp;
      HBase file format with inline blocks (version 2)
      </td></tr></table></div></body></html>