<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>1.6.&nbsp;Schema Design</title><link rel="stylesheet" type="text/css" href="../css/freebsd_docbook.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><link rel="home" href="performance.html" title="Chapter&nbsp;1.&nbsp;Apache HBase Performance Tuning"><link rel="up" href="performance.html" title="Chapter&nbsp;1.&nbsp;Apache HBase Performance Tuning"><link rel="prev" href="perf.zookeeper.html" title="1.5.&nbsp;ZooKeeper"><link rel="next" href="perf.general.html" title="1.7.&nbsp;HBase General Patterns"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1.6.&nbsp;Schema Design</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="perf.zookeeper.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="perf.general.html">Next</a></td></tr></table><hr></div><script type="text/javascript">
    var disqus_shortname = 'hbase'; // required: replace example with your forum shortname
    var disqus_url = 'http://hbase.apache.org/book/perf.schema.html';
    </script><div class="section" title="1.6.&nbsp;Schema Design"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="perf.schema"></a>1.6.&nbsp;Schema Design</h2></div></div></div><div class="section" title="1.6.1.&nbsp;Number of Column Families"><div class="titlepage"><div><div><h3 class="title"><a name="perf.number.of.cfs"></a>1.6.1.&nbsp;Number of Column Families</h3></div></div></div><p>See <a class="xref" href="">???</a>.</p></div><div class="section" title="1.6.2.&nbsp;Key and Attribute Lengths"><div class="titlepage"><div><div><h3 class="title"><a name="perf.schema.keys"></a>1.6.2.&nbsp;Key and Attribute Lengths</h3></div></div></div><p>See <a class="xref" href="">???</a>. See also <a class="xref" href="perf.schema.html#perf.compression.however" title="1.6.7.1.&nbsp;However...">Section&nbsp;1.6.7.1, &#8220;However...&#8221;</a> for compression caveats.</p></div><div class="section" title="1.6.3.&nbsp;Table RegionSize"><div class="titlepage"><div><div><h3 class="title"><a name="schema.regionsize"></a>1.6.3.&nbsp;Table RegionSize</h3></div></div></div><p>The regionsize can be set on a per-table basis via <code class="code">setFileSize</code> on <a class="link" href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/HTableDescriptor.html" target="_top">HTableDescriptor</a>
        in the event where certain tables require different regionsizes than the configured default
        regionsize. </p><p>See <a class="xref" href="">???</a> for more information. </p></div><div class="section" title="1.6.4.&nbsp;Bloom Filters"><div class="titlepage"><div><div><h3 class="title"><a name="schema.bloom"></a>1.6.4.&nbsp;Bloom Filters</h3></div></div></div><p>A Bloom filter, named for its creator, Burton Howard Bloom, is a data structure which is
        designed to predict whether a given element is a member of a set of data. A positive result
        from a Bloom filter is not always accurate, but a negative result is guaranteed to be
        accurate. Bloom filters are designed to be "accurate enough" for sets of data which are so
        large that conventional hashing mechanisms would be impractical. For more information about
        Bloom filters in general, refer to <a class="link" href="http://en.wikipedia.org/wiki/Bloom_filter" target="_top">http://en.wikipedia.org/wiki/Bloom_filter</a>.</p><p>In terms of HBase, Bloom filters provide a lightweight in-memory structure to reduce the
        number of disk reads for a given Get operation (Bloom filters do not work with Scans) to only the StoreFiles likely to
        contain the desired Row. The potential performance gain increases with the number of
        parallel reads. </p><p>The Bloom filters themselves are stored in the metadata of each HFile and never need to
        be updated. When an HFile is opened because a region is deployed to a RegionServer, the
        Bloom filter is loaded into memory. </p><p>HBase includes some tuning mechanisms for folding the Bloom filter to reduce the size
        and keep the false positive rate within a desired range.</p><p>Bloom filters were introduced in <a class="link" href="https://issues.apache.org/jira/browse/HBASE-1200" target="_top">HBASE-1200</a>. Since
        HBase 0.96, row-based Bloom filters are enabled by default. (<a class="link" href="https://issues.apache.org/jira/browse/HBASE-8450" target="_top">HBASE-</a>)</p><p>For more information on Bloom filters in relation to HBase, see <a class="xref" href="perf.reading.html#blooms" title="1.9.9.&nbsp;Bloom Filters">Section&nbsp;1.9.9, &#8220;Bloom Filters&#8221;</a> for more information, or the following Quora discussion: <a class="link" href="http://www.quora.com/How-are-bloom-filters-used-in-HBase" target="_top">How are bloom
          filters used in HBase?</a>. </p><div class="section" title="1.6.4.1.&nbsp;When To Use Bloom Filters"><div class="titlepage"><div><div><h4 class="title"><a name="bloom.filters.when"></a>1.6.4.1.&nbsp;When To Use Bloom Filters</h4></div></div></div><p>Since HBase 0.96, row-based Bloom filters are enabled by default. You may choose to
          disable them or to change some tables to use row+column Bloom filters, depending on the
          characteristics of your data and how it is loaded into HBase.</p><p>To determine whether Bloom filters could have a positive impact, check the value of
          <code class="code">blockCacheHitRatio</code> in the RegionServer metrics. If Bloom filters are enabled, the value of
          <code class="code">blockCacheHitRatio</code> should increase, because the Bloom filter is filtering out blocks that
          are definitely not needed. </p><p>You can choose to enable Bloom filters for a row or for a row+column combination. If
          you generally scan entire rows, the row+column combination will not provide any benefit. A
          row-based Bloom filter can operate on a row+column Get, but not the other way around.
          However, if you have a large number of column-level Puts, such that a row may be present
          in every StoreFile, a row-based filter will always return a positive result and provide no
          benefit. Unless you have one column per row, row+column Bloom filters require more space,
          in order to store more keys. Bloom filters work best when the size of each data entry is
          at least a few kilobytes in size. </p><p>Overhead will be reduced when your data is stored in a few larger StoreFiles, to avoid
          extra disk IO during low-level scans to find a specific row. </p><p>Bloom filters need to be rebuilt upon deletion, so may not be appropriate in
          environments with a large number of deletions.</p></div><div class="section" title="1.6.4.2.&nbsp;Enabling Bloom Filters"><div class="titlepage"><div><div><h4 class="title"><a name="d9542e549"></a>1.6.4.2.&nbsp;Enabling Bloom Filters</h4></div></div></div><p>Bloom filters are enabled on a Column Family. You can do this by using the
          setBloomFilterType method of HColumnDescriptor or using the HBase API. Valid values are
            <code class="literal">NONE</code> (the default), <code class="literal">ROW</code>, or
            <code class="literal">ROWCOL</code>. See <a class="xref" href="perf.schema.html#bloom.filters.when" title="1.6.4.1.&nbsp;When To Use Bloom Filters">Section&nbsp;1.6.4.1, &#8220;When To Use Bloom Filters&#8221;</a> for more information on <code class="literal">ROW</code> versus
            <code class="literal">ROWCOL</code>. See also the API documentation for <a class="link" href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/HColumnDescriptor.html" target="_top">HColumnDescriptor</a>.</p><p>The following example creates a table and enables a ROWCOL Bloom filter on the
            <code class="literal">colfam1</code> column family.</p><pre class="screen">
hbase&gt; <strong class="userinput"><code>create 'mytable',{NAME =&gt; 'colfam1', BLOOMFILTER =&gt; 'ROWCOL'}</code></strong>          
        </pre></div><div class="section" title="1.6.4.3.&nbsp;Configuring Server-Wide Behavior of Bloom Filters"><div class="titlepage"><div><div><h4 class="title"><a name="d9542e584"></a>1.6.4.3.&nbsp;Configuring Server-Wide Behavior of Bloom Filters</h4></div></div></div><p>You can configure the following settings in the <code class="filename">hbase-site.xml</code>.
        </p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Parameter</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><p><code class="code">io.hfile.bloom.enabled</code></p></td><td><p><code class="literal">yes</code></p></td><td><p>Set to <code class="literal">no</code> to kill bloom filters server-wide if
                    something goes wrong</p></td></tr><tr><td><p><code class="code">io.hfile.bloom.error.rate</code></p></td><td><p><code class="literal">.01</code></p></td><td><p>The average false positive rate for bloom filters. Folding is used to
                  maintain the false positive rate. Expressed as a decimal representation of a
                  percentage.</p></td></tr><tr><td><p><code class="code">io.hfile.bloom.max.fold</code></p></td><td><p><code class="literal">7</code></p></td><td><p>The guaranteed maximum fold rate. Changing this setting should not be
                  necessary and is not recommended.</p></td></tr><tr><td><p><code class="code">io.storefile.bloom.max.keys</code></p></td><td><p><code class="literal">128000000</code></p></td><td><p>For default (single-block) Bloom filters, this specifies the maximum
                    number of keys.</p></td></tr><tr><td><p><code class="code">io.storefile.delete.family.bloom.enabled</code></p></td><td><p><code class="literal">true</code></p></td><td><p>Master switch to enable Delete Family Bloom filters and store them in
                  the StoreFile.</p></td></tr><tr><td><p><code class="code">io.storefile.bloom.block.size</code></p></td><td><p><code class="literal">65536</code></p></td><td><p>Target Bloom block size. Bloom filter blocks of approximately this size
                    are interleaved with data blocks.</p></td></tr><tr><td><p><code class="code">hfile.block.bloom.cacheonwrite</code></p></td><td><p><code class="literal">false</code></p></td><td><p>Enables cache-on-write for inline blocks of a compound Bloom filter.</p></td></tr></tbody></table></div></div></div><div class="section" title="1.6.5.&nbsp;ColumnFamily BlockSize"><div class="titlepage"><div><div><h3 class="title"><a name="schema.cf.blocksize"></a>1.6.5.&nbsp;ColumnFamily BlockSize</h3></div></div></div><p>The blocksize can be configured for each ColumnFamily in a table, and this defaults to
        64k. Larger cell values require larger blocksizes. There is an inverse relationship between
        blocksize and the resulting StoreFile indexes (i.e., if the blocksize is doubled then the
        resulting indexes should be roughly halved). </p><p>See <a class="link" href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/HColumnDescriptor.html" target="_top">HColumnDescriptor</a>
        and <a class="xref" href="">???</a>for more information. </p></div><div class="section" title="1.6.6.&nbsp;In-Memory ColumnFamilies"><div class="titlepage"><div><div><h3 class="title"><a name="cf.in.memory"></a>1.6.6.&nbsp;In-Memory ColumnFamilies</h3></div></div></div><p>ColumnFamilies can optionally be defined as in-memory. Data is still persisted to disk,
        just like any other ColumnFamily. In-memory blocks have the highest priority in the <a class="xref" href="">???</a>, but it is not a guarantee that the entire table will be in
        memory. </p><p>See <a class="link" href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/HColumnDescriptor.html" target="_top">HColumnDescriptor</a>
        for more information. </p></div><div class="section" title="1.6.7.&nbsp;Compression"><div class="titlepage"><div><div><h3 class="title"><a name="perf.compression"></a>1.6.7.&nbsp;Compression</h3></div></div></div><p>Production systems should use compression with their ColumnFamily definitions. See <a class="xref" href="">???</a> for more information. </p><div class="section" title="1.6.7.1.&nbsp;However..."><div class="titlepage"><div><div><h4 class="title"><a name="perf.compression.however"></a>1.6.7.1.&nbsp;However...</h4></div></div></div><p>Compression deflates data <span class="emphasis"><em>on disk</em></span>. When it's in-memory (e.g., in
          the MemStore) or on the wire (e.g., transferring between RegionServer and Client) it's
          inflated. So while using ColumnFamily compression is a best practice, but it's not going
          to completely eliminate the impact of over-sized Keys, over-sized ColumnFamily names, or
          over-sized Column names. </p><p>See <a class="xref" href="">???</a> on for schema design tips, and <a class="xref" href="">???</a> for more information on HBase stores data internally. </p></div></div></div><div id="disqus_thread"></div><script type="text/javascript">
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="perf.zookeeper.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="perf.general.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1.5.&nbsp;ZooKeeper&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="performance.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;1.7.&nbsp;HBase General Patterns</td></tr></table></div></body></html>